(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15720,        474]
NotebookOptionsPosition[     15369,        460]
NotebookOutlinePosition[     15764,        476]
CellTagsIndexPosition[     15721,        473]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"initialSudokuBoard", "=", 
   RowBox[{"SparseArray", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}], "->", "5"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], "->", "3"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], "->", "8"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "8"}], "}"}], "->", "2"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "2"}], "}"}], "->", "7"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "5"}], "}"}], "->", "1"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "7"}], "}"}], "->", "5"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "1"}], "}"}], "->", "4"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "6"}], "}"}], "->", "5"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"4", ",", "7"}], "}"}], "->", "3"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"5", ",", "2"}], "}"}], "->", "1"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"5", ",", "5"}], "}"}], "->", "7"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"5", ",", "9"}], "}"}], "->", "6"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "3"}], "}"}], "->", "3"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "4"}], "}"}], "->", "2"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"6", ",", "8"}], "}"}], "->", "8"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"7", ",", "2"}], "}"}], "->", "6"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"7", ",", "4"}], "}"}], "->", "5"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"7", ",", "9"}], "}"}], "->", "9"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"8", ",", "3"}], "}"}], "->", "4"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"8", ",", "8"}], "}"}], "->", "3"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"9", ",", "6"}], "}"}], "->", "9"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"9", ",", "7"}], "}"}], "->", "7"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "9"}], "}"}], ",", "_"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "initialSudokuBoard", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "z", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"squareConstraints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{"z", "[", 
          RowBox[{"i", ",", "j"}], "]"}], "]"}], "==", "1"}], ",", 
       RowBox[{"0", "\[VectorLessEqual]", 
        RowBox[{"z", "[", 
         RowBox[{"i", ",", "j"}], "]"}], "\[VectorLessEqual]", "1"}], ",", 
       RowBox[{
        RowBox[{"z", "[", 
         RowBox[{"i", ",", "j"}], "]"}], "\[Element]", 
        RowBox[{"Vectors", "[", 
         RowBox[{"9", ",", "Integers"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "9"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "9"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"onesVector", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"1", ",", "9"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rowConstraints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"z", "[", 
         RowBox[{"i", ",", "j"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "9"}], "}"}]}], "]"}], "==", "onesVector"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "9"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"columnConstraints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"z", "[", 
         RowBox[{"i", ",", "j"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "9"}], "}"}]}], "]"}], "==", "onesVector"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "9"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blockConstraints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"z", "[", 
         RowBox[{
          RowBox[{"i", "+", "m"}], ",", 
          RowBox[{"j", "+", "n"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "3"}], "}"}]}], "]"}], "==", "onesVector"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "3", ",", "6"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "3", ",", "6"}], "}"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sudokuConstraints", "=", 
   RowBox[{"{", 
    RowBox[{
    "squareConstraints", ",", "rowConstraints", ",", "columnConstraints", ",",
      "blockConstraints"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"z", "[", 
       RowBox[{"i", ",", "j"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "9"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "9"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"knownConstraints", "=", 
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Indexed", "[", 
        RowBox[{
         RowBox[{"z", "@@", "#1"}], ",", "#2"}], "]"}], "==", "1"}], "&"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"initialSudokuBoard", "[", "\"\<NonzeroPositions\>\"", "]"}], 
       ",", 
       RowBox[{"initialSudokuBoard", "[", "\"\<NonzeroValues\>\"", "]"}]}], 
      "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"res", "=", 
   RowBox[{"LinearOptimization", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"sudokuConstraints", ",", "knownConstraints"}], "}"}], ",", 
     "vars"}], "]"}]}], ";"}], "\n", 
 RowBox[{"Short", "[", 
  RowBox[{"res", ",", "3"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Short", "[", 
  RowBox[{
   RowBox[{"pos", "=", 
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"List", "@@", "#1"}], "->", 
        RowBox[{
         RowBox[{"Range", "[", "9", "]"}], ".", "#2"}]}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"vars", ",", 
        RowBox[{"vars", "/.", " ", "res"}]}], "}"}]}], "]"}]}], ",", "4"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  
  RowBox[{"SparseArray", "[", "pos", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<SolveSudokuPuzzle\>\"", "]"}], "[", 
  "initialSudokuBoard", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullSudokuPuzzle", "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<SolveSudokuPuzzle\>\"", "]"}], "[", 
    
    RowBox[{"SparseArray", "@", 
     RowBox[{"DiagonalMatrix", "[", 
      RowBox[{"RandomSample", "[", 
       RowBox[{"Range", "[", "9", "]"}], "]"}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "fullSudokuPuzzle", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialPuzzle", "=", 
   RowBox[{"SparseArray", "@", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{
      RowBox[{"RandomSample", "[", 
       RowBox[{"Range", "[", "9", "]"}], "]"}], "*", 
      RowBox[{"RandomChoice", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"-", "1"}]}], "}"}], ",", "9"}], "]"}]}], "]"}]}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"refSudokuMat", "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<SolveSudokuPuzzle\>\"", "]"}], "[", 
    "initialPuzzle", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "refSudokuMat", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"minElementsToKeep", "=", "50"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sudokuElements", "=", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"refSudokuMat", "[", "\"\<NonzeroPositions\>\"", "]"}], "->", 
      RowBox[{"refSudokuMat", "[", "\"\<NonzeroValues\>\"", "]"}]}], "]"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"n", "=", "81"}], ";", 
  RowBox[{"i", "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"While", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "sudokuElements", "]"}], ">", 
      "minElementsToKeep"}], "&&", 
     RowBox[{"i", "<", "n"}]}], ",", 
    RowBox[{
     RowBox[{"newElements", "=", "sudokuElements"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"newElements", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "2"}], "]"}], "]"}], "*=", 
      RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{"ResourceFunction", "[", "\"\<SolveSudokuPuzzle\>\"", "]"}], 
       "[", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"newElements", ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "9"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"res", "===", "$Failed"}], ",", 
       RowBox[{
        RowBox[{"sudokuElements", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"sudokuElements", ",", "i"}], "]"}]}], ";", 
        RowBox[{"n", "--"}]}], ",", 
       RowBox[{"i", "++"}]}], "]"}], ";"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sudokuPuzzle", "=", 
   RowBox[{"SparseArray", "[", 
    RowBox[{"sudokuElements", ",", 
     RowBox[{"{", 
      RowBox[{"9", ",", "9"}], "}"}], ",", "_"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "sudokuPuzzle", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], 
    "[", "#", "]"}], "&"}], "/@", 
  RowBox[{"{", 
   RowBox[{"refSudokuMat", ",", 
    RowBox[{
     RowBox[{"ResourceFunction", "[", "\"\<SolveSudokuPuzzle\>\"", "]"}], "[",
      "sudokuPuzzle", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}], "=", 
  RowBox[{
   RowBox[{"ResourceFunction", "[", "\"\<GenerateSudokuPuzzle\>\"", "]"}], 
   "[", 
   RowBox[{"3", ",", "0.4"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], 
    "[", "#", "]"}], "&"}], "/@", 
  RowBox[{"{", 
   RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}], "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<GenerateSudokuPuzzle\>\"", "]"}], 
    "[", 
    RowBox[{"2", ",", "0.5"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], 
    "[", "#", "]"}], "&"}], "/@", 
  RowBox[{"{", 
   RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}], "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<GenerateSudokuPuzzle\>\"", "]"}], 
    "[", 
    RowBox[{"4", ",", "0.6"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], 
    "[", "#", "]"}], "&"}], "/@", 
  RowBox[{"{", 
   RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}], "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<GenerateSudokuPuzzle\>\"", "]"}], 
    "[", 
    RowBox[{"3", ",", "0.4"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "ResourceFunction", "[", "\"\<EstimateSudokuDifficultyLevel\>\"", "]"}], 
  "[", "sudokuPuzzle", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"fullBoard", ",", "sudokuPuzzle"}], "}"}], "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<GenerateSudokuPuzzle\>\"", "]"}], 
    "[", 
    RowBox[{"3", ",", "0."}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "ResourceFunction", "[", "\"\<EstimateSudokuDifficultyLevel\>\"", "]"}], 
  "[", "sudokuPuzzle", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "sudokuPuzzle", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Short", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Indexed", "[", 
       RowBox[{"y", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}]}], "]"}], "==", 
      RowBox[{
       RowBox[{"Range", "[", "9", "]"}], ".", 
       RowBox[{"z", "[", 
        RowBox[{"i", ",", "j"}], "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "9"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "9"}], "}"}]}], "]"}], ",", "2"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Short", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"refSudokuBoard", ",", 
      RowBox[{"{", 
       RowBox[{"cagePos", ",", "cageVals"}], "}"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{
     "ResourceFunction", "[", "\"\<GenerateKillerSudokuPuzzle\>\"", "]"}], 
     "[", "]"}]}], ",", "4"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplayKillerSudokuPuzzle\>\"", "]"}],
   "[", 
  RowBox[{"cagePos", ",", "cageVals"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "refSudokuBoard", "]"}], "\[IndentingNewLine]", 
 RowBox[{"solvedPuzzle", "=", 
  RowBox[{
   RowBox[{"ResourceFunction", "[", "\"\<SolveKillerSudokuPuzzle\>\"", "]"}], 
   "[", 
   RowBox[{"cagePos", ",", "cageVals"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResourceFunction", "[", "\"\<DisplaySudokuPuzzle\>\"", "]"}], "[", 
  "solvedPuzzle", "]"}]}], "Input",ExpressionUUID->"79b84847-b434-4476-9d42-\
8d47956963e8"]
},
WindowSize->{1015, 791},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"13.2 for Mac OS X x86 (64-bit) (January 30, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ced09898-4c54-445f-96ac-461953923cb4"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 14807, 438, 1102, "Input",ExpressionUUID->"79b84847-b434-4476-9d42-8d47956963e8"]
}
]
*)

